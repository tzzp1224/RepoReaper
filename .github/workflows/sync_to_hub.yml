name: Sync to Hugging Face hub
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          # è¯·ç¡®ä¿ä¸‹é¢ä¸¤è¡Œæ˜¯ä½ çš„ç”¨æˆ·åå’Œ Space åç§°
          HF_USERNAME: realdexter   
          SPACE_NAME: RepoReaper  
        run: |
          echo "ğŸš€ Starting deployment to Hugging Face..."
          
          # 1. é…ç½® Git ç”¨æˆ·
          git config --global user.email "bot@github.com"
          git config --global user.name "GitHub Actions Bot"
          
          # 2. ã€å…³é”®ã€‘åˆ é™¤ä¼šå¯¼è‡´æŠ¥é”™çš„äºŒè¿›åˆ¶æ–‡ä»¶æ–‡ä»¶å¤¹
          # Hugging Face åªéœ€è¦ä»£ç è¿è¡Œï¼Œä¸éœ€è¦ demo gif å›¾ç‰‡
          echo "ğŸ§¹ Cleaning up binary files..."
          rm -rf docs/
          rm -f *.jpg *.png *.gif
          
          # 3. ã€æ ¸å¼¹æ­¥éª¤ã€‘åˆ é™¤ .git æ–‡ä»¶å¤¹
          # è¿™ä¼šæ¸…é™¤æ‰€æœ‰çš„ Git å†å²è®°å½•ï¼Œè§£å†³ "binary files in history" é—®é¢˜
          rm -rf .git
          
          # 4. é‡æ–°åˆå§‹åŒ–ä¸€ä¸ªå…¨æ–°çš„ Git ä»“åº“
          git init -b main
          git add .
          git commit -m "deploy: auto-sync from github (clean state)"
          
          # 5. å¼ºåˆ¶æ¨é€åˆ° Hugging Face
          # æ³¨æ„ï¼šè¿™ä¼šè¦†ç›– HF ä¸Šæ‰€æœ‰çš„å†å²è®°å½•ï¼Œä½†åœ¨éƒ¨ç½²åœºæ™¯ä¸‹é€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„
          git remote add space https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_USERNAME/$SPACE_NAME
          git push --force space main
          
          echo "âœ… Deployment successful!"