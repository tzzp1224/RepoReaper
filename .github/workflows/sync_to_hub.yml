name: Sync to Hugging Face hub
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: realdexter   
          SPACE_NAME: RepoReaper  
        run: |
          echo "ğŸš€ Starting deployment to Hugging Face..."
          
          # 1. é…ç½® Git
          git config --global user.email "bot@github.com"
          git config --global user.name "GitHub Actions Bot"
          
          # 2. ã€æ ¸å¿ƒé­”æ³•ã€‘åŠ¨æ€ç”Ÿæˆ Hugging Face ä¸“ç”¨çš„ README
          # è¿™ä¸€æ­¥ä¼šåœ¨å‘é€ç»™ HF ä¹‹å‰ï¼Œå¼ºè¡Œåœ¨ README.md é¡¶éƒ¨æ’å…¥é…ç½®å¤´
          # GitHub æœ¬åœ°çš„æ–‡ä»¶ä¸ä¼šå—å½±å“ï¼Œä¾ç„¶ä¿æŒå¹²å‡€æ¼‚äº®
          echo "---" > hf_header.yml
          echo "title: RepoReaper" >> hf_header.yml
          echo "emoji: ğŸ’€" >> hf_header.yml
          echo "colorFrom: blue" >> hf_header.yml
          echo "colorTo: indigo" >> hf_header.yml
          echo "sdk: docker" >> hf_header.yml
          echo "pinned: false" >> hf_header.yml
          echo "app_port: 8000" >> hf_header.yml # ğŸ‘ˆ å…³é”®ï¼šè¿™é‡ŒæŒ‡å®šç«¯å£ï¼Œä½ å°±ä¸ç”¨æ”¹ä»£ç äº†
          echo "---" >> hf_header.yml
          echo "" >> hf_header.yml
          
          # å°†é…ç½®å¤´å’ŒåŸ README å†…å®¹æ‹¼æ¥
          cat hf_header.yml README.md > README_temp.md
          mv README_temp.md README.md
          
          # 3. æ¸…ç†ä¸éœ€è¦çš„æ–‡ä»¶
          rm -rf docs/
          rm -f *.jpg *.png *.gif hf_header.yml
          rm -rf .git
          
          # 4. åˆå§‹åŒ–æ–°ä»“åº“å¹¶æ¨é€
          git init -b main
          git add .
          git commit -m "deploy: auto-inject hf config & sync"
          
          git remote add space https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_USERNAME/$SPACE_NAME
          git push --force space main
          
          echo "âœ… Deployment successful! Config header injected on-the-fly."