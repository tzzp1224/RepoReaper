name: Sync to Hugging Face hub
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true
      
      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          # 注意：下面这两行请替换成你自己的用户名和 Space 名称
          HF_USERNAME: realdexter 
          SPACE_NAME: RepoReaper  
        run: |
          git config --global user.email "bot@github.com"
          git config --global user.name "GitHub Actions Bot"
          
          # === 核心修复步骤：强制使用 LFS 追踪二进制文件 ===
          git lfs install
          # 追踪导致报错的图片格式
          git lfs track "docs/*.jpg"
          git lfs track "docs/*.gif"
          git lfs track "*.png"
          
          # 确保 .gitattributes 被添加
          git add .gitattributes
          
          # 提交这个变更 (这一步会在 Action 临时环境中把普通文件转为 LFS 指针)
          git commit -m "chore: convert binaries to LFS for Hugging Face" || true
          # ====================================================

          git remote add space https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_USERNAME/$SPACE_NAME
          git push --force space main