<!DOCTYPE html>
<html>
<head>
    <title>GitHub AI Agent</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        #logs { background: #f4f4f4; padding: 1rem; border-radius: 8px; height: 150px; overflow-y: auto; font-family: monospace; }
        #report { margin-top: 2rem; white-space: pre-wrap; line-height: 1.6; }
        .step { color: #666; margin-bottom: 0.5rem; }
        .highlight { color: #007bff; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ•µï¸ GitHub Agent Dashboard</h1>
    <input type="text" id="repoUrl" value="https://github.com/fastapi/fastapi" style="width: 70%; padding: 0.5rem;">
    <button onclick="startAnalysis()" style="padding: 0.5rem 1rem; cursor: pointer;">å¼€å§‹åˆ†æ</button>
    
    <h3>ğŸš€ è¿è¡Œæ—¥å¿— (Logs)</h3>
    <div id="logs">ç­‰å¾…å¼€å§‹...</div>

    <h3>ğŸ“ åˆ†ææŠ¥å‘Š (Report)</h3>
    <div id="report"></div>

    <script>
        function startAnalysis() {
            const url = document.getElementById('repoUrl').value;
            const logDiv = document.getElementById('logs');
            const reportDiv = document.getElementById('report');
            
            logDiv.innerHTML = "";
            reportDiv.innerHTML = "æ­£åœ¨è¿æ¥ Agent...";
            
            // â­ï¸ æ ¸å¿ƒæŠ€æœ¯ï¼šEventSource (SSE)
            // è¿æ¥ FastAPI çš„æµå¼æ¥å£
            const eventSource = new EventSource(`http://127.0.0.1:8000/analyze?url=${encodeURIComponent(url)}`);

            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.step === 'report_chunk') {
                    // å¦‚æœæ˜¯æŠ¥å‘Šç‰‡æ®µï¼Œè¿½åŠ åˆ°æŠ¥å‘ŠåŒºåŸŸ
                    if (reportDiv.innerHTML === "æ­£åœ¨è¿æ¥ Agent...") reportDiv.innerHTML = "";
                    reportDiv.innerHTML += data.chunk;
                } else if (data.step === 'finish') {
                    logDiv.innerHTML += `<div class="step">âœ… <b>Done</b></div>`;
                    eventSource.close(); // å…³é—­è¿æ¥
                } else if (data.step === 'error') {
                    logDiv.innerHTML += `<div class="step" style="color:red">âŒ ${data.message}</div>`;
                    eventSource.close();
                } else {
                    // å¦‚æœæ˜¯æ™®é€šæ—¥å¿—
                    logDiv.innerHTML += `<div class="step">ğŸ‘‰ ${data.message}</div>`;
                    logDiv.scrollTop = logDiv.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                }
            };

            eventSource.onerror = function(err) {
                console.error("EventSource failed:", err);
                eventSource.close();
            };
        }
    </script>
</body>
</html>